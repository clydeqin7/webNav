<!DOCTYPE html>
<html lang="zh-hans">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>网站导航</title>
    <link rel="stylesheet" href="style.css">
    <link rel="shortcut icon" type="image/png" href="./imgSrc/favicon.png"/>
</head>

<body>
    <header>
        <!--<kbd class="test">s</kbd>-->
    </header>
    <main>
        <div class="mainWrapper" id="mainxx"></div>
    </main>
    <footer></footer>
    <script>
        // 1.初始化
        var hashA = init()
        var keyboards = hashA['key']
        var hash = hashA['hash']
        
        // 2.生成键盘
        generateKayboard(keyboards, hash)

        // 3.监听用户点击事件
        listenToUser(hash)


        /* 以下是功能函数 */
        // 根据元素名生成标签
        function tag(eLementName) {
            return document.createElement(eLementName)
        }

        function getFromLocalStorage(name) {
            return JSON.parse(localStorage.getItem(name) || 'null')
        }

        function createSpan(textContent) {
            var span = tag('span')
            span.textContent = textContent
            return span
        }

        function createButton(id) {
            var buttonX = tag('button')
            buttonX.id = id
            buttonX.textContent = "编辑"

            buttonX.onclick = function (xdfsf) {
                var button2 = xdfsf['target']
                var img2 = button2.previousSibling
                var key = xdfsf['target']['id'] //得到哪个键点击了编辑
                var x = prompt('请输入一个网址') //获取用户输入的内容  
                if (x) {
                    hash[key] = x
                    img2.src = 'http://' + x + '/favicon.ico'
                }

                img2.onerror = function () {
                    img2.src = './imgSrc/point.png'
                }

                //将修改后的hash存到localStorage
                localStorage.setItem('cHash', JSON.stringify(hash))
            }

            return buttonX
        }

        function createImg(domain) {
            var imgX = tag("img")
            if (domain) {
                imgX.src = 'http://' + domain + '/favicon.ico'
            } else {
                imgX.src = './imgSrc/point.png'
            }

            imgX.onerror = function (xxx) {
                xxx.target.src = './imgSrc/point.png'
            }

            return imgX
        }

        function generateKayboard(keyboards, hash){
            for(var index = 0;index < keyboards.length;index = index + 1){
                var div1 = tag('div')
                mainxx.appendChild(div1)

                for(var kbdIndex = 0;
                kbdIndex < keyboards[index].length; // 遍历keyboards中的数组
                kbdIndex = kbdIndex + 1){
                    var currentLocal = keyboards[index][kbdIndex]
                    var ckbd = tag('kbd')

                    var spanX = createSpan(currentLocal)
                    var imgX = createImg(hash[currentLocal])
                    var buttonX = createButton(currentLocal)

                    ckbd.appendChild(spanX)
                    ckbd.appendChild(imgX)
                    ckbd.appendChild(buttonX)

                    div1.appendChild(ckbd)
                }
            }
        }

        function listenToUser(hash){
            document.onkeypress = function (xsjkdjfa){
                var key = xsjkdjfa['key']
                var website = 'http://' + hash[key]
                //location.href = website //当前页面跳转
                window.open(website, '_blank')
            }           
        }

        function init(){
            var keyboards = {
                0: ['q', 'w', 'e', 'r', 't', 'y', 'u', 'i', 'o', 'p'],
                1: ['a', 's', 'd', 'f', 'g', 'h', 'j', 'k', 'l'],
                2: ['z', 'x', 'c', 'v', 'b', 'n', 'm'],
                'length': 3
            }

            var hash = {
                'q': 'qq.com',
                'w': 'weibo.com',
                'e': 'ebay.com',
                'r': 'reddit.com',
                't': 'taobao.com',
                'y': 'youtube.com',
                'u': 'udacity.com',
                'i': 'iqiyi.com',
                'o': 'opera.com',
                'p': '',
                'a': 'amazon.com',
                's': 'stackoverflow.com',
                'd': 'douyu.com',
                'f': '',
                'g': 'google.com',
                'h': 'hackerearth.com',
                'j': 'jiuzhang.com',
                'k': '36kr.com',
                'l': 'lintcode.com',
                'z': 'zhihu.com',
                'x': '',
                'c': 'Codecademy.com',
                'v': 'v2ex.com',
                'b': 'bilibili.com',
                'n': 'norvig.com',
                'm': 'meituan.com'
            }


            // 取出loaclStorage的hash
            var hashInLocalStorage = getFromLocalStorage('cHash')
            if (hashInLocalStorage) {
                hash = hashInLocalStorage
            }

            return {'key':keyboards, 'hash':hash}
        }
                
    </script>
</body>

</html>